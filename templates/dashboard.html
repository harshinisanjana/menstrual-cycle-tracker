<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Menstrual Cycle Tracker">
    <meta name="author" content="TemplateMo">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">

    <title>Dashboard - Menstrual Cycle Tracker</title>

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-lava.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl-carousel.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>
    <!-- ***** Preloader Start ***** -->
    <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <!-- ***** Preloader End ***** -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - PinkCycle</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon">üå∏</span>
                <span class="logo-text">PinkCycle</span>
            </div>
            <ul class="nav-links">
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li><a href="{{ url_for('logout') }}" onclick="return confirm('Are you sure you want to logout?')">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- Dashboard -->
    <div class="dashboard">
        <div class="dashboard-header">
            <h1>Welcome back, {{ username }}! üëã</h1>
            <p class="subtitle">Track your cycle and understand your body better</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Input Form -->
        <div class="dashboard-container">
            <div class="card form-card">
                <h2>üìù Track Your Cycle</h2>
                <form method="POST" class="cycle-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="last_period_start">Last Period Start Date</label>
                            <input type="date" id="last_period_start" name="last_period_start" 
                                   value="{{ last_period_start if last_period_start else '' }}" required>
                        </div>
                        <div class="form-group">
                            <label for="cycle_length">Cycle Length (days)</label>
                            <input type="number" id="cycle_length" name="cycle_length" min="21" max="35"
                                   value="{{ cycle_length if cycle_length else '' }}" required>
                        </div>
                        <div class="form-group">
                            <label for="day">Current Day in Cycle</label>
                            <input type="number" id="day" name="day" min="1" max="35"
                                   value="{{ day if day else '' }}" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Generate Predictions</button>
                </form>
            </div>

            <!-- Cycle Phase Card -->
            {% if current_phase %}
            <div class="card phase-card phase-{{ current_phase|lower }}">
                <div class="phase-icon">
                    {% if current_phase == 'Menstrual' %}
                        ü©∏
                    {% elif current_phase == 'Follicular' %}
                        üå±
                    {% elif current_phase == 'Ovulation' %}
                        ‚ú®
                    {% elif current_phase == 'Luteal' %}
                        üåô
                    {% endif %}
                </div>
                <h2>Current Phase</h2>
                <p class="phase-name">{{ current_phase }}</p>
                <p class="phase-description">
                    {% if current_phase == 'Menstrual' %}
                        Your menstrual phase - rest and hydrate
                    {% elif current_phase == 'Follicular' %}
                        Rising energy and hormones
                    {% elif current_phase == 'Ovulation' %}
                        Peak energy and fertility
                    {% elif current_phase == 'Luteal' %}
                        Winding down, rest ahead
                    {% endif %}
                </p>
            </div>
            {% endif %}

            <!-- Hormones Card -->
            {% if estrogen is not none and progesterone is not none %}
            <div class="card hormone-card">
                <h2>üß¨ Hormone Levels</h2>
                <div class="hormone-grid">
                    <div class="hormone-item">
                        <span class="hormone-label">Estrogen</span>
                        <span class="hormone-value">{{ estrogen|round(2) }}</span>
                    </div>
                    <div class="hormone-item">
                        <span class="hormone-label">Progesterone</span>
                        <span class="hormone-value">{{ progesterone|round(2) }}</span>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Next Period Card -->
            {% if next_period_start %}
            <div class="card period-card">
                <h2>üìÖ Next Period</h2>
                <p class="period-date">{{ next_period_start.strftime('%B %d, %Y') }}</p>
                {% set next_period_date = next_period_start.date() %}
                {% set today_date = today %}
                {% if next_period_date == today_date %}
                    <p class="period-status warning">‚ö†Ô∏è Your period is expected to start today!</p>
                {% elif next_period_date < today_date %}
                    <p class="period-status warning">üõë Your period seems to be delayed</p>
                {% elif (next_period_date - today_date).days <= 3 %}
                    <p class="period-status approaching">‚è∞ Your period is approaching soon</p>
                {% else %}
                    {% set days_left = (next_period_date - today_date).days %}
                    <p class="period-status">{{ days_left }} days until your next period</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Ovulation Card -->
            {% if ovulation_info %}
            <div class="card ovulation-card">
                <h2>üéØ Ovulation Window</h2>
                <p class="ovulation-day">Day {{ ovulation_info['ovulation_day'] }}</p>
                <p class="ovulation-window">
                    Days {{ ovulation_info['ovulation_window'][0] }} - {{ ovulation_info['ovulation_window'][1] }}
                </p>
                <p class="ovulation-label">Peak fertility window</p>
            </div>
            {% endif %}

            <!-- Hormone Chart -->
            {% if plot_url %}
            <div class="card chart-card">
                <h2>üìä Hormone Levels Chart</h2>
                <img src="data:image/png;base64,{{ plot_url }}" alt="Hormone Chart" class="chart-image">
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 PinkCycle. Your cycle, your way.</p>
    </footer>

    <script>
        function confirmLogout() {
            return confirm("Are you sure you want to log out?");
        }
    </script>
</body>
</html>
